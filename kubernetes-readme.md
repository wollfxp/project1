# Deploying application to Kubernetes

> Files are located in `src/main/k8s`


##Deploying provided kubernetes files (based on ones generated by Kompose)
1. deploy mysql `cd src/main/k8s && kubectl create -f mysql-pvc.yaml -f mysql-service.yaml -f mysql-deployment.yaml` 
2. deploy ssl certificate as kubernetes secret `kubectl create secret generic spacekey --from-file=./../resources/spacekey.p12`
3. build the app `cd ./../../.. && ./gradlew clean build`
4. build the docker image `docker build -t starships .`
5. deploy the app `cd src/main/k8s && kubectl create -f starships-service.yaml -f starships-deployment.yaml`
6. expose the service `kubectl expose deployment starships --port=8443 --protocol=TCP --target-port=8443 --type=LoadBalancer --name=starships-lb`
7. access [https://localhost:8443/]
8. scale the app `kubectl scale --replicas=3 deployment.apps/starships`
9. `kubectl get all`

##Using Kompose to convert docker-compose.yml
1. Converting your docker-compose file to kubernetes format: `kompose convert -f docker-compose.yaml`
2. deploy them to kubernetes `kubectl apply -f .`
3. check the pods' status `kubectl get pods`
4. find out what is the name of app pod: `kubectl get pods -l io.kompose.service=starships -o jsonpath="{.items[0].metadata.name}"`
5. port-forward the application port to local machine `kubectl port-forward <POD_NAME> 8443:8443`
6. access [https://localhost:8443/]
7. it works!

